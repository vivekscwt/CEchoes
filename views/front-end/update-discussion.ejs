
  <%- include('common/header') -%>
<link href="/front-end/css/profile-dashboard-style.css" rel="stylesheet" type="text/css">
<link href="/front-end/css/company-profile-dashboard.css" rel="stylesheet" type="text/css">
<%- include('common/header-banner') -%>

  <div class="my-profile-wrapper">
    <form id="discussionForm">
      <% getDiscussionByDiscusId.forEach(discussion=> { %>
        <input type="hidden" name="discussion_id" value="<%= discussion.id %>">
        <div class="col-sm-6">
          <div id="sendreviewtags_discussion" class="custom-form">
              <label style="background-color: #ffffff;">Tags</label>
              <% const parsedTags = discussion.tags ? JSON.parse(discussion.tags) : []; %>
              <input 
              type="text" 
              name="tags" 
              placeholder="Add tag" 
              data-gtm-form-interact-field-id="0"
              value="<%=parsedTags%>" >
          </div>
      </div>
        <div class="row">
          <div class="col-sm-6">
            <div class="custom-form">
              <label><span style="background-color: #ffffff;">Discussion Topic<span
                    style="color: red;">*</span></span></label>
              <textarea name="topic" id="search-topic" class="form-control mb-4"
                required><%= discussion.topic %></textarea>
            </div>
          </div>
        </div>
        <div class="autofield-dropdown">
        </div>

        <% const date=new Date(); %>
          <% const year=date.getFullYear(); const month=String(date.getMonth() + 1).padStart(2, '0' ); const
            day=String(date.getDate()).padStart(2, '0' ); const formattedDate=`${year}-${month}-${day}`; %>
            <div class="row">
              <div class="col-sm-6">
                <div class="custom-form">
                  <label><span style="background-color: #ffffff;">From</span></label>
                  <% const fromDate=new Date(discussion.created_at); %>
                    <% const formattedFromDate=fromDate.toISOString().split('T')[0]; %>
                      <input type="date" class="form-control" name="from_data" value="<%= formattedFromDate %>"
                        placeholder="" style="pointer-events: none;">
                </div>
              </div>
            </div>

            <% const nextyear=date.getFullYear() + 1; const nextmonth=String(date.getMonth() + 1).padStart(2, '0' );
              const nextday=String(date.getDate()).padStart(2, '0' ); 
              const nextYearDate=`${nextyear}-${nextmonth}-${nextday}`; %>
              <div class="row">
                <div class="col-sm-6">
                  <div class="custom-form">
                    <label><span style="background-color: #ffffff;">To</span></label>
                    <% const toDate=new Date(discussion.expired_at); %>
                      <% const formattedToDate=toDate.toISOString().split('T')[0]; %>
                        <input type="date" class="form-control" name="expire_date" value="<%= formattedToDate %>"
                          style="padding-right: 18px;">
                  </div>
                </div>
              </div>
              <% }); %>

                <% if(currentUserData){ %>
                  <div class="custom-form mb-sm-0">
                    <input type="hidden" name="user_id" value="<%= currentUserData.user_id %>" />
                    <input type="submit" class="btn-default btn-warning" value="Submit">
                  </div>
                  <% } %>
                  <div class="register-now frm-loading" style="display: none;">
                    <span class="indicator-progress">Please wait...
                      <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                    </span>
                  </div>
              
                  <div
                    style=" width: 100%; text-align: center; display: block; border: 2px solid #fccb06; padding: 6px; margin-top: 20px; border-radius: 5px; display: none;"
                    class="response-message"></div>
    </form>

</div>

    <%- include('common/footer') -%>

      <style>
        #sendreviewtags_discussion {
          border: 2px solid #fccb06;
          padding: 5px 9px;
          border-radius: 6px;
          margin-bottom: 32px;
        }

        #sendreviewtags_discussion>span {
          cursor: pointer;
          display: block;
          float: left;
          color: #fff;
          background: #fccb06;
          padding: 7px;
          padding-right: 25px;
          margin: 4px;
          border-radius: 4px;
        }

        #sendreviewtags_discussion>span:after {
          position: absolute;
          content: "Ã—";
          border: 1px solid;
          padding: 2px 5px;
          margin-left: 3px;
          font-size: 11px;
        }

        #sendreviewtags_discussion>input {
          background: #f2f2f2;
          border: 0;
          margin: 4px;
          padding: 7px;
          width: auto;
          border-radius: 4px;
          outline: none;
        }
      </style>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"> </script>
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
      <script>
        $(document).ready(function () {
          $("#discussionForm").submit(function (e) {
            e.preventDefault();

            var formData = $(this).serialize();

            $.ajax({
              url: "/auth/update-discussion",
              type: "POST",
              data: formData,
              success: function (response) {
                console.log(response);

                if (response.status == 'ok') {
              Swal.fire({
                icon: 'success',
                title: 'Discussion Updated Successfully',
                showConfirmButton: false,
                timer: 1500 
              }).then(function() {
                window.location.reload();
              });
            } else {
              Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'Failed to update discussion.'
              });
            }
              },
              error: function (xhr, status, error) {
                console.error(xhr.responseText);
                Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'An error occurred while updating the discussion. Please try again later.'
              });
              }
            });
          });
        });
      </script>